var CircleAudioPlayerSkins={"default":{outerCircle:{color:"gradient:linear:#f5f5f5:#e8e8e8"},progressBar:{loadColor:"rgba(255, 255, 255, 0.7)",fillColor:"gradient:linear:rgba(255, 110, 2, 1.000):rgba(255, 255, 0, 1.000):rgba(255, 109, 0, 1.000)",margin:20,shadow:{type:"inner"}},innerCircle:{color:"gradient:linear:#ececec:#d4d4d4",margin:35,shadow:{type:"outer"}},buttons:{playColor:"#666666",playHoverColor:"#00ff00",pauseColor:"#666666",pauseHoverColor:"#ff0000",soundLed:{color:"#666666",size:1}}}};
(function(f){var h={radius:100,skin:"default"},g=function(a,b){this.id=this._guid();this.element=f(a);this.options=f.extend({},h,b);this.radius=100;this.scale=1;this.diameter=2*this.radius;this.played=this.loaded=0;this.is_dragged=this.is_mousedown=this.is_mouseover=!1;this.ctx=this.canvas=this.prev_pt=this.start_pt=null;this.init()};g.prototype={constructor:g,config:{skins:CircleAudioPlayerSkins},init:function(){this._create();this._bindEvents();this.render()},getSkin:function(){return this.config.skins[this.options.skin]},
_guid:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},_create:function(){this.canvas=f("<canvas></canvas>").attr("width",this.diameter+"px").attr("height",this.diameter+"px").css({width:this.diameter+"px",height:this.diameter+"px",cursor:"pointer","user-select":"none","-webkit-user-select":"none","-moz-user-select":"none"});this.ctx=this.canvas[0].getContext("2d");if(this.options.radius!=this.radius){var a=
this.options.radius/this.radius;this.scale=a;this.canvas.attr("width",this.diameter*a+"px").attr("height",this.diameter*a+"px").width(this.diameter*a).height(this.diameter*a);this.ctx.scale(a,a)}this.element.after(this.canvas).hide()},_bindEvents:function(){this.element.on("progress",this._onProgress);this.element.on("timeupdate",this._onTimeUpdate);this.element.on("canplay",this._onProgress);var a=this;this.canvas.hover(function(){a.is_mouseover=!0;a.render()},function(){a.is_mouseover=!1;a.render()});
this.canvas.on("mousedown touchstart MSPointerDown",function(b){a.is_mousedown=!0;a.prev_pt=a.start_pt=a._getMousePos(b)});this.canvas.on("mousemove touchmove MSPointerMove",function(b){a._onMove(b)});this.canvas.on("mouseup touchend MSPointerUp",function(b){a._onClick(b)})},_onProgress:function(a){a=f(this).data("circle-audio-player");var b=this.duration;try{var c=this.buffered.end(this.buffered.length-1);a.loaded=c/b;a.render()}catch(d){}},_onTimeUpdate:function(a){a=f(this).data("circle-audio-player");
a.played=this.currentTime/this.duration;a.render()},_onMove:function(a){this.getSkin();if(this.is_mousedown){this.is_dragged=!0;var b=this.element[0];a=this._getMousePos(a);var c=this._getMouseAngle(this.prev_pt),d=this._getMouseAngle(a);try{b.volume=c>d?.01<=b.volume?b.volume-=.01:0:.99>=b.volume?b.volume+=.01:1}catch(e){}this.prev_pt=a;this.render()}},_onClick:function(a){a=this._getMousePos(a);var b=this.getSkin(),c=b.progressBar.margin?b.progressBar.margin:0;this._inRadius(this.radius,this.radius,
a.x,a.y,this.radius-(b.innerCircle.margin?b.innerCircle.margin:0))?this.is_dragged||(b=this.element[0],b.paused?b.play():b.pause()):this._inRadius(this.radius,this.radius,a.x,a.y,this.radius-c)&&(b=this.element[0],a=Math.atan2(a.y-this.radius,a.x-this.radius),0>a&&(a=6+a),this.played=a/6,b.currentTime=b.duration*this.played);this.is_dragged=this.is_mousedown=!1;this.render()},render:function(){var a=this.getSkin();this.ctx.clearRect(0,0,this.diameter,this.diameter);this._drawCircle(a.outerCircle);
this._drawProgressBar(a.progressBar);this._drawCircle(a.innerCircle);this._drawButton()},_parseColor:function(a){var b=this.radius,c=this.radius,d=2*c;if("object"==typeof a){b="radial"==a.type?a.positions?this.ctx.createRadialGradient.apply(this.ctx,a.positions):this.ctx.createRadialGradient(b,b,0,b,b,b):a.positions?this.ctx.createLinearGradient.apply(this.ctx,a.positions):this.ctx.createLinearGradient(0,0,d,d);if(a.distribute)for(var e=0;e<a.distribute.length;e++)b.addColorStop(a.distribute[e],a.colors[e]);
else for(c=1/(a.colors.length-1),e=d=0;e<a.colors.length;e++)b.addColorStop(d,a.colors[e]),d+=c;return b}if(a.match(/^gradient/)){a=a.split(":");b="radial"==a[1]?this.ctx.createRadialGradient(b,b,0,b,b,b):"linear-v"==a[1]?this.ctx.createLinearGradient(c,0,c,d):"linear-h"==a[1]?this.ctx.createLinearGradient(0,c,d,c):this.ctx.createLinearGradient(0,0,d,d);e=2;if(a[2].match(/^distribute/))for(var e=3,d=0,f=a[2].replace(/^distribute-/,"").split(",");e<a.length;e++)c=parseFloat(f[d++],10),b.addColorStop(c,
a[e]);else for(c=1/(a.length-3),d=0;e<a.length;e++)b.addColorStop(d,a[e]),d+=c;return b}return a},_drawCircle:function(a){this.ctx.save();var b=this.radius,c=this.radius;a.margin&&(b-=a.margin);a.stroke&&(b-=a.stroke.width);if(a.color){var d=a.angle?a.angle*Math.PI*2:2*Math.PI;this.ctx.beginPath();this.ctx.moveTo(c,c);this.ctx.arc(c,c,b,0,d,!1);this.ctx.fillStyle=this._parseColor(a.color,c,b);this.ctx.closePath();a.shadow&&"outer"==a.shadow.type&&(this.ctx.lineWidth=0,this.ctx.shadowBlur=(a.shadow.blur?
a.shadow.blur:5)*this.scale,this.ctx.shadowColor=a.shadow.color?a.shadow.color:"rgba(0, 0, 0, 0.6)",this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0);a.stroke&&(console.log(a.stroke),this.ctx.lineWidth=a.stroke.width,this.ctx.strokeStyle=this._parseColor(a.stroke.color),this.ctx.stroke());this.ctx.fill()}a.shadow&&"inner"==a.shadow.type&&(this.ctx.beginPath(),this.ctx.arc(c,c,b,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.beginPath(),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=a.shadow.width?a.shadow.width:
5,this.ctx.shadowBlur=(a.shadow.blur?a.shadow.blur:5)*this.scale,this.ctx.shadowColor=a.shadow.color?a.shadow.color:"rgba(0, 0, 0, 0.6)",this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.arc(c,c,b+3,0,2*Math.PI,!1),this.ctx.stroke());this.ctx.restore()},_drawProgressBar:function(a){0<this.loaded&&this._drawCircle({color:a.loadColor,angle:this.loaded,margin:a.margin});0<this.played&&this._drawCircle({color:a.fillColor,stroke:a.stroke?a.stroke:null,angle:this.played,margin:a.margin});this._drawCircle(a)},
_drawButton:function(){var a=this.getSkin(),b=a.buttons;this.ctx.save();var c=this.radius,d=this.element[0],e=!d.paused,f=e?"\u2759\u2759":"\u25ba",g=e?0:5;this.ctx.save();this.ctx.font="normal bold 50px arial";this.ctx.textAlign="center";this.ctx.textBaseline="middle";this.ctx.fillStyle=this._parseColor(e?this.is_mouseover?b.pauseHoverColor:b.pauseColor:this.is_mouseover?b.playHoverColor:b.playColor,c,c);this.ctx.fillText(f,c+g,c);f="\u00b7";c=c-(a.innerCircle.margin?a.innerCircle.margin:0)-5/this.scale;
this.ctx.font="normal bold "+(b.soundLed.size?3<b.soundLed.size?3:b.soundLed.size:1)/this.scale*20+"px sans serif";this.ctx.textAlign="center";this.ctx.textBaseline="middle";d=180*d.volume;a=this.radius+Math.cos(d*Math.PI/180)*c;d=this.radius+Math.sin(d*Math.PI/180)*c;this.ctx.fillStyle=this._parseColor(b.soundLed.color,c,c);this.ctx.fillText(f,a,d);this.ctx.restore()},_inRadius:function(a,b,c,d,e){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))<e},_getMousePos:function(a){if(a.touches&&1<a.touches.length){var b=
a.touches[0].offsetX;a=a.touches[0].offsetY}else b=a.offsetX,a=a.offsetY;b/=this.scale;a/=this.scale;return{x:b,y:a}},_getMouseAngle:function(a){a=180*Math.atan2(a.y-this.radius,a.x-this.radius)/Math.PI;0>a&&(a=360+a);return a}};f.fn.circleAudioPlayer=function(){f(this).each(function(){var a=f(this).data("radius")?f(this).data("radius"):100,b=f(this).data("skin")?f(this).data("skin"):"default",a=new g(f(this)[0],{radius:a,skin:b});f(this).data("circle-audio-player",a)})};f(function(){f("[data-circle-audio-player]").circleAudioPlayer()})})(jQuery);CircleAudioPlayerSkins=CircleAudioPlayerSkins||{};
CircleAudioPlayerSkins.prototype=$.extend(CircleAudioPlayerSkins,{plane:{outerCircle:{color:"rgba(0,0,0,0)"},progressBar:{loadColor:"rgba(178,230,23,1)",fillColor:"#0095DA"},innerCircle:{color:"#F5F5F5",margin:15},buttons:{playColor:"#666666",playHoverColor:"#0095DA",pauseColor:"#666666",pauseHoverColor:"#0095DA",soundLed:{color:"#666666",size:1}}},black:{outerCircle:{color:"gradient:linear:#585858:#A6A6A6"},progressBar:{loadColor:"rgba(255, 255, 255, 0.7)",fillColor:"gradient:radial:distribute-0,0.733,0.991:rgba(255, 238, 40, 1.000):rgba(130, 194, 238, 1.000):rgba(40, 40, 40, 1.000)",
margin:20,shadow:{type:"inner"}},innerCircle:{color:"gradient:radial:#7f7f7f:#474646",margin:35,shadow:{type:"outer"}},buttons:{playColor:"#666666",playHoverColor:"#0095DA",pauseColor:"#666666",pauseHoverColor:"#0095DA",soundLed:{color:"#00ff00",size:1}}},green:{outerCircle:{color:"gradient:linear:#005400:#008000"},progressBar:{loadColor:"rgba(255, 255, 255, 0.4)",fillColor:"gradient:radial:rgba(0, 128, 0, 1.000):rgba(0, 84, 0, 1.000)",margin:20,shadow:{type:"inner"}},innerCircle:{color:"gradient:radial:#008000:#005400",
margin:35,shadow:{type:"outer"}},buttons:{playColor:"#005400",playHoverColor:"#44ce44",pauseColor:"#005400",pauseHoverColor:"#44ce44",soundLed:{color:"#00ff00",size:1}}},glossy:{outerCircle:{color:"rgba(0,0,0,0)"},progressBar:{loadColor:"rgba(255, 255, 255, 0.4)",fillColor:"#000000"},innerCircle:{color:{type:"linear",distribute:[0,.5,.52,1],positions:[100,0,100,200],colors:["#e2e2e2","#dbdbdb","#d1d1d1","#fefefe"]},margin:35,shadow:{type:"outer"}},buttons:{playColor:"gradient:linear-v:distribute-0,0.5,0.52,1:#aebcbf:#6e7774:#0a0e0a:#0a0809",
playHoverColor:"gradient:linear-v:distribute-0,0.5,0.52,1:#F85032:#f16f5c:#f6290c:#e73827",pauseColor:"gradient:linear-v:distribute-0,0.5,0.52,1:#aebcbf:#6e7774:#0a0e0a:#0a0809",pauseHoverColor:"gradient:linear-v:distribute-0,0.5,0.52,1:#F85032:#f16f5c:#f6290c:#e73827",soundLed:{color:"#ff0000",size:1}}}});
